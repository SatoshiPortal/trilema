<!DOCTYPE html>
<html lang="en">

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<meta http-equiv="Cache-control" content="private,max-age:9800">
	<meta name="description" content="Planet Earth's most widely read blog." /> 
	<meta name="robots" content="index,follow,noarchive" />
<link rel="icon" href="http://trilema.com/favicon.ico" type="image/x-icon" />

	<link rel="stylesheet" href="http://trilema.com/wp-content/themes/trilema/style.css" type="text/css" media="screen" />

<style type="text/css">  body {      	background: #fff url('http://trilema.com/wp-content/themes/trilema/images/bg_oct2009.jpg') no-repeat center top; }  </style>

	<link rel="alternate" type="application/atom+xml" title="Atom 0.3" href="http://trilema.com/feed/atom/" />
	<link rel="alternate" type="application/rss+xml" title="Trilema RSS Feed" href="http://trilema.com/feed/" />
	<link rel="pingback" href="http://trilema.com/xmlrpc.php" />
		<title>The ideal Bitcoin wallet on Trilema - A blog by Mircea Popescu.</title>
	<style type="text/css">
						ol.footnotes li {list-style-type:lower-roman;}
						ol.footnotes{font-size:0.8em; color:#000000;}		</style>


	
</head>
<body>


<div id="base">
	<div id="mask_head_ie"></div>
	<div id="base2">
		<div id="header">
			<div id="blogtitle"><a href="http://trilema.com">Trilema</a></div>
			<div id="subtitle">Evil broadly consists of people who<br />aren't very good and don't want to get any better.
</div>



			

		</div>
		<div id="mask_foot"></div>
		<div id="container">
<div id="content">        <div class="spacer"></div>             <span id="shash-67843"><div class="post" id="post-67843">                    <h1><a href="http://trilema.com/2016/the-ideal-bitcoin-wallet/" rel="bookmark" title="Permanent Link to The ideal Bitcoin wallet">The ideal Bitcoin wallet</a></h1>                        <div class="date">                                     Saturday, 30 July, Year 8 d.Tr.&nbsp;|&nbsp;Author: <a href="http://trilema.com/author/admin/" title="Posts by Mircea Popescu">Mircea Popescu</a>                                                        </div>

                        <div class="entry">
<p><em>I'm writing this down mostly to be used as a discussion basis / scratchpad by the tech minds in TMSR. It is publicly accessible for historical reasons, which doesn't automatically mean you have something to contribute to the discussion.<sup><a href="#footnote_0_67843" id="identifier_0_67843" class="footnote-link footnote-identifier-link" title="Historical means what people will say long after you - our anonymous and therefore by then forgotten contemporary - will have finally disappeared without remainder.">i</a></sup></em></p>
<p><strong>A. Separation of cache and datastore functions.</strong> While it is true that without caching relevant transactions "simple"<sup><a href="#footnote_1_67843" id="identifier_1_67843" class="footnote-link footnote-identifier-link" title="There could, and obviously there should, for which reason there won't be written entire books on the meaning of `simple` in extended worlds. 
What is a `simple` expectation such as `we can resolve systems of equations` supposed mean in a properly multivariate world ? The `lesswrong` crowd of idiots may well proceed in their John Smith-esque manner, much like the country bumpkin harbors the `simple` expectation that he may slay dragons and figure out how to use the subway on the basis of his prior experience back home with trapping rabbits and finding his way to the outhouse. You however have no such excuse, not here at any rate.
Do you expect `simple` rules to hold forever, as some sort of token of a wholly imagined `deep connection` between you and `the universe` ? Are you an idiot ?">ii</a></sup> requirements such as "tell me how much I have" become <a href="http://trilema.com/forum-logs-for-16-jun-2016#2109848">O(N) (per address!)</a>, this is nevertheless no excuse to keep the two <em>in the same file</em> (and see below).</p>
<p><strong>B. Textual representation.</strong> With some general reference to the broader topic of literacy (as opposed to symbology) amply discussed in the logs<sup><a href="#footnote_2_67843" id="identifier_2_67843" class="footnote-link footnote-identifier-link" title="22nd of July 2016 ; 24th of February 2016 ; 3rd of February 2016 ; 11th of January 2016 ; 29th of October 2015. You are expected to read these.">iii</a></sup>, there is no acceptable reason for the wallet data to be stored in any format that is not readily comprehensible, <em>and editable</em>. This means ASCII<sup><a href="#footnote_3_67843" id="identifier_3_67843" class="footnote-link footnote-identifier-link" title="And if it were stored as such, A wouldn't be much of a problem! Such is the power of correct design - that it protects you from `problems` which can't even exist in your space. Such is the curse of idiotic feelings - that they create problems entirely out of thin air.
Stop being women. It's unseemly, shameful and wicked in the eyes of the lordship.">iv</a></sup>, strictly.</p>
<p><strong>C. Proper password space.</strong> Currently wallet passphrases are <a href="http://btcbase.org/log/2015-09-09#1267191">both weak and remarkable</a>. The extant wallet encryption scheme<sup><a href="#footnote_4_67843" id="identifier_4_67843" class="footnote-link footnote-identifier-link" title="Create master key, encrypt it via AES-256-CBC on the basis of a key derived from a sha-2 (a version known-weak re preimage resistance for 57 rounds or fewer) and a number of rounds `derived from the speed of the machine` - often not over 60 for this reason! The individual privkeys are then encrypted to this master key through a dubious process. Various metadata is not itself encrypted. The code itself is not lengthy : 
#include `crypter.h`#include `script.h`#include &lt;string>#include &lt;vector>#include &lt;boost/foreach.hpp>#include &lt;openssl/aes.h>#include &lt;openssl/evp.h>bool CCrypter::SetKeyFromPassphrase(const SecureString&#038; strKeyData, const std::vector&lt;unsigned char>&#038; chSalt, const unsigned int nRounds, const unsigned int nDerivationMethod){    if (nRounds &lt; 1 || chSalt.size() != WALLET_CRYPTO_SALT_SIZE)        return false;    int i = 0;    if (nDerivationMethod == 0)        i = EVP_BytesToKey(EVP_aes_256_cbc(), EVP_sha512(), &#038;chSalt[0],                          (unsigned char *)&#038;strKeyData[0], strKeyData.size(), nRounds, chKey, chIV);    if (i != (int)WALLET_CRYPTO_KEY_SIZE)    {        OPENSSL_cleanse(chKey, sizeof(chKey) );        OPENSSL_cleanse(chIV, sizeof(chIV) );        return false;    }    fKeySet = true;    return true;}bool CCrypter::SetKey(const CKeyingMaterial&#038; chNewKey, const std::vector&lt;unsigned char>&#038; chNewIV){    if (chNewKey.size() != WALLET_CRYPTO_KEY_SIZE || chNewIV.size() != WALLET_CRYPTO_KEY_SIZE)        return false;    memcpy(&#038;chKey[0], &#038;chNewKey[0], sizeof chKey);    memcpy(&#038;chIV[0], &#038;chNewIV[0], sizeof chIV);    fKeySet = true;    return true;}bool CCrypter::Encrypt(const CKeyingMaterial&#038; vchPlaintext, std::vector&lt;unsigned char> &#038;vchCiphertext){    if (!fKeySet)        return false;    // max ciphertext len for a n bytes of plaintext is    // n + AES_BLOCK_SIZE - 1 bytes    int nLen = vchPlaintext.size();    int nCLen = nLen + AES_BLOCK_SIZE, nFLen = 0;    vchCiphertext = std::vector&lt;unsigned char> (nCLen);    EVP_CIPHER_CTX ctx;    bool fOk = true;    EVP_CIPHER_CTX_init(&#038;ctx);    if (fOk) fOk = EVP_EncryptInit_ex(&#038;ctx, EVP_aes_256_cbc(), NULL, chKey, chIV);    if (fOk) fOk = EVP_EncryptUpdate(&#038;ctx, &#038;vchCiphertext[0], &#038;nCLen, &#038;vchPlaintext[0], nLen);    if (fOk) fOk = EVP_EncryptFinal_ex(&#038;ctx, (&#038;vchCiphertext[0])+nCLen, &#038;nFLen);    EVP_CIPHER_CTX_cleanup(&#038;ctx);    if (!fOk) return false;    vchCiphertext.resize(nCLen + nFLen);    return true;}bool CCrypter::Decrypt(const std::vector&lt;unsigned char>&#038; vchCiphertext, CKeyingMaterial&#038; vchPlaintext){    if (!fKeySet)        return false;    // plaintext will always be equal to or lesser than length of ciphertext    int nLen = vchCiphertext.size();    int nPLen = nLen, nFLen = 0;    vchPlaintext = CKeyingMaterial(nPLen);    EVP_CIPHER_CTX ctx;    bool fOk = true;    EVP_CIPHER_CTX_init(&#038;ctx);    if (fOk) fOk = EVP_DecryptInit_ex(&#038;ctx, EVP_aes_256_cbc(), NULL, chKey, chIV);    if (fOk) fOk = EVP_DecryptUpdate(&#038;ctx, &#038;vchPlaintext[0], &#038;nPLen, &#038;vchCiphertext[0], nLen);    if (fOk) fOk = EVP_DecryptFinal_ex(&#038;ctx, (&#038;vchPlaintext[0])+nPLen, &#038;nFLen);    EVP_CIPHER_CTX_cleanup(&#038;ctx);    if (!fOk) return false;    vchPlaintext.resize(nPLen + nFLen);    return true;}bool EncryptSecret(const CKeyingMaterial&#038; vMasterKey, const CKeyingMaterial &#038;vchPlaintext, const uint256&#038; nIV, std::vector&lt;unsigned char> &#038;vchCiphertext){    CCrypter cKeyCrypter;    std::vector&lt;unsigned char> chIV(WALLET_CRYPTO_KEY_SIZE);    memcpy(&#038;chIV[0], &#038;nIV, WALLET_CRYPTO_KEY_SIZE);    if(!cKeyCrypter.SetKey(vMasterKey, chIV) )        return false;    return cKeyCrypter.Encrypt(*( (const CKeyingMaterial*)&#038;vchPlaintext), vchCiphertext);}bool DecryptSecret(const CKeyingMaterial&#038; vMasterKey, const std::vector&lt;unsigned char>&#038; vchCiphertext, const uint256&#038; nIV, CKeyingMaterial&#038; vchPlaintext){    CCrypter cKeyCrypter;    std::vector&lt;unsigned char> chIV(WALLET_CRYPTO_KEY_SIZE);    memcpy(&#038;chIV[0], &#038;nIV, WALLET_CRYPTO_KEY_SIZE);    if(!cKeyCrypter.SetKey(vMasterKey, chIV) )        return false;    return cKeyCrypter.Decrypt(vchCiphertext, *( (CKeyingMaterial*)&#038;vchPlaintext) );}bool CCryptoKeyStore::SetCrypted(){    LOCK(cs_KeyStore);    if (fUseCrypto)        return true;    if (!mapKeys.empty() )        return false;    fUseCrypto = true;    return true;}bool CCryptoKeyStore::Lock(){    if (!SetCrypted() )        return false;    {        LOCK(cs_KeyStore);        vMasterKey.clear();    }    NotifyStatusChanged(this);    return true;}bool CCryptoKeyStore::Unlock(const CKeyingMaterial&#038; vMasterKeyIn){    {        LOCK(cs_KeyStore);        if (!SetCrypted() )            return false;        CryptedKeyMap::const_iterator mi = mapCryptedKeys.begin();        for (; mi != mapCryptedKeys.end(); ++mi)        {            const CPubKey &#038;vchPubKey = (*mi).second.first;            const std::vector&lt;unsigned char> &#038;vchCryptedSecret = (*mi).second.second;            CKeyingMaterial vchSecret;            if(!DecryptSecret(vMasterKeyIn, vchCryptedSecret, vchPubKey.GetHash(), vchSecret) )                return false;            if (vchSecret.size() != 32)                return false;            CKey key;            key.Set(vchSecret.begin(), vchSecret.end(), vchPubKey.IsCompressed() );            if (key.GetPubKey() == vchPubKey)                break;            return false;        }        vMasterKey = vMasterKeyIn;    }    NotifyStatusChanged(this);    return true;}bool CCryptoKeyStore::AddKeyPubKey(const CKey&#038; key, const CPubKey &#038;pubkey){    {        LOCK(cs_KeyStore);        if (!IsCrypted() )            return CBasicKeyStore::AddKeyPubKey(key, pubkey);        if (IsLocked() )            return false;        std::vector&lt;unsigned char> vchCryptedSecret;        CKeyingMaterial vchSecret(key.begin(), key.end() );        if (!EncryptSecret(vMasterKey, vchSecret, pubkey.GetHash(), vchCryptedSecret) )            return false;        if (!AddCryptedKey(pubkey, vchCryptedSecret) )            return false;    }    return true;}bool CCryptoKeyStore::AddCryptedKey(const CPubKey &#038;vchPubKey, const std::vector&lt;unsigned char> &#038;vchCryptedSecret){    {        LOCK(cs_KeyStore);        if (!SetCrypted() )            return false;        mapCryptedKeys[vchPubKey.GetID()] = make_pair(vchPubKey, vchCryptedSecret);    }    return true;}bool CCryptoKeyStore::GetKey(const CKeyID &#038;address, CKey&#038; keyOut) const{    {        LOCK(cs_KeyStore);        if (!IsCrypted() )            return CBasicKeyStore::GetKey(address, keyOut);        CryptedKeyMap::const_iterator mi = mapCryptedKeys.find(address);        if (mi != mapCryptedKeys.end() )        {            const CPubKey &#038;vchPubKey = (*mi).second.first;            const std::vector&lt;unsigned char> &#038;vchCryptedSecret = (*mi).second.second;            CKeyingMaterial vchSecret;            if (!DecryptSecret(vMasterKey, vchCryptedSecret, vchPubKey.GetHash(), vchSecret) )                return false;            if (vchSecret.size() != 32)                return false;            keyOut.Set(vchSecret.begin(), vchSecret.end(), vchPubKey.IsCompressed() );            return true;        }    }    return false;}bool CCryptoKeyStore::GetPubKey(const CKeyID &#038;address, CPubKey&#038; vchPubKeyOut) const{    {        LOCK(cs_KeyStore);        if (!IsCrypted() )            return CKeyStore::GetPubKey(address, vchPubKeyOut);        CryptedKeyMap::const_iterator mi = mapCryptedKeys.find(address);        if (mi != mapCryptedKeys.end() )        {            vchPubKeyOut = (*mi).second.first;            return true;        }    }    return false;}bool CCryptoKeyStore::EncryptKeys(CKeyingMaterial&#038; vMasterKeyIn){    {        LOCK(cs_KeyStore);        if (!mapCryptedKeys.empty() || IsCrypted() )            return false;        fUseCrypto = true;        BOOST_FOREACH(KeyMap::value_type&#038; mKey, mapKeys)        {            const CKey &#038;key = mKey.second;            CPubKey vchPubKey = key.GetPubKey();            CKeyingMaterial vchSecret(key.begin(), key.end() );            std::vector&lt;unsigned char> vchCryptedSecret;            if (!EncryptSecret(vMasterKeyIn, vchSecret, vchPubKey.GetHash(), vchCryptedSecret) )                return false;            if (!AddCryptedKey(vchPubKey, vchCryptedSecret) )                return false;        }        mapKeys.clear();    }    return true;}

Many eyes, right ? ">v</a></sup> has certain supposed strengths<sup><a href="#footnote_5_67843" id="identifier_5_67843" class="footnote-link footnote-identifier-link" title="There is no way currently known to bruteforce an encrypted wallet.dat file.">vi</a></sup> and various weaknesses, both known<sup><a href="#footnote_6_67843" id="identifier_6_67843" class="footnote-link footnote-identifier-link" title="Metadata not encrypted ; rounds may be insufficient ; individual private key to master key encryption may be weak ; AES is suspicious by its NIST-nature ; passphrases are weaker than their size naively promises, and readily recognized in a string dump.">vii</a></sup> and unknown. The whole thing should be reviewed in all seriousness ; the password issue must be fixed in any case. A stand-alone wallet encrypter/decrypter/verifier is required so that people can check wallets with a tool that doesn't have the capability of emptying them at the same time.</p>
<p><strong>D. Better support code and integration generally.</strong> The accounting functions as provided by Bitcoin code are a notorious laughingstock the shame therewhich will burn through the generations undulled. The current input selection process is idiotic to say the least. Absent a <a href="http://btcbase.org/log/2015-03-23#1065768">proper computed solution</a>, the correct approach is the direct : inputs are selected <em>in the order they are found in the wallet</em> (which the user can modify to his heart's content, as per B above) up to the sum of the required outputs. Various other items<sup><a href="#footnote_7_67843" id="identifier_7_67843" class="footnote-link footnote-identifier-link" title="Modularity for instance might be a good idea, there's no reason for a third party to know what exact encryption scheme any end user employs for his wallet.">viii</a></sup>.</p>
<p>It's about high time already, if the sorry state of PRB with its inept "we replaced BDB with LevelDB only to a) create bugs, unintentional forks and generally an unmaintainable mess ; and b) to still keep the BDB code for the wallet anyway" wasn't enough to make that point.</p>
&mdash;&mdash;&mdash;<ol class="footnotes"><li id="footnote_0_67843" class="footnote">Historical means what people will say long after you - our anonymous and therefore by then forgotten contemporary - will have finally disappeared without remainder. [<a href="#identifier_0_67843" class="footnote-link footnote-back-link">&#8617;</a>]</li><li id="footnote_1_67843" class="footnote">There could, and obviously there should, for which reason there won't be written entire books on the meaning of "simple" in extended worlds. </p>
<p>What is a "simple" expectation such as "we can resolve systems of equations" supposed mean in a properly <a href="http://trilema.com/2016/multivariate-calculus-for-experts/">multivariate world</a> ? The "lesswrong" <a href="http://trilema.com/2015/the-harry-potter-challenge/">crowd of idiots</a> may well proceed in their <a href="http://trilema.com/2011/hai-sa-facem-un-exercitiu/">John Smith</a>-esque manner, much like the country bumpkin harbors the "simple" expectation that he may slay dragons and figure out how to use the subway on the basis of his prior experience back home with trapping rabbits and finding his way to the outhouse. You however have no such excuse, not here at any rate.</p>
<p>Do you expect <a href="http://trilema.com/forum-logs-for-11-jul-2016#2128135">"simple" rules</a> to hold forever, as some sort of token of a wholly imagined "deep connection" between you and "the universe" ? Are you an idiot ? [<a href="#identifier_1_67843" class="footnote-link footnote-back-link">&#8617;</a>]</li><li id="footnote_2_67843" class="footnote"><a href="http://trilema.com/forum-logs-for-22-jul-2016#2135123">22nd of July 2016</a> ; <a href="http://trilema.com/forum-logs-for-24-feb-2016#2037582">24th of February 2016</a> ; <a href="http://btcbase.org/log/2016-02-03#1394862">3rd of February 2016</a> ; <a href="http://btcbase.org/log/2016-01-11#1366834">11th of January 2016</a> ; <a href="http://btcbase.org/log/2015-10-29#1311079">29th of October 2015</a>. You are expected to read these. [<a href="#identifier_2_67843" class="footnote-link footnote-back-link">&#8617;</a>]</li><li id="footnote_3_67843" class="footnote">And if it were stored as such, A wouldn't be much of a problem! Such is the power of correct design - that it protects you from "problems" which can't even exist in your space. Such is the curse of idiotic feelings - that they create problems entirely out of thin air.</p>
<p>Stop being women. It's unseemly, shameful and wicked in the eyes of the lordship. [<a href="#identifier_3_67843" class="footnote-link footnote-back-link">&#8617;</a>]</li><li id="footnote_4_67843" class="footnote">Create master key, encrypt it via AES-256-CBC on the basis of a key derived from a sha-2 (a version known-weak re preimage resistance for 57 rounds or fewer) and a number of rounds "derived from the speed of the machine" - often not over 60 for this reason! The individual privkeys are then encrypted to this master key through a dubious process. Various metadata is not itself encrypted. The code itself is not lengthy : </p>
<blockquote><div style="white-space: pre-wrap;">#include "crypter.h"<br />#include "script.h"<br />#include &lt;string><br />#include &lt;vector><br />#include &lt;boost/foreach.hpp><br />#include &lt;openssl/aes.h><br />#include &lt;openssl/evp.h><br />bool CCrypter::SetKeyFromPassphrase(const SecureString&#038; strKeyData, const std::vector&lt;unsigned char>&#038; chSalt, const unsigned int nRounds, const unsigned int nDerivationMethod)<br />{<br />    if (nRounds &lt; 1 || chSalt.size() != WALLET_CRYPTO_SALT_SIZE)<br />        return false;<br />    int i = 0;<br />    if (nDerivationMethod == 0)<br />        i = EVP_BytesToKey(EVP_aes_256_cbc(), EVP_sha512(), &#038;chSalt[0],<br />                          (unsigned char *)&#038;strKeyData[0], strKeyData.size(), nRounds, chKey, chIV);<br />    if (i != (int)WALLET_CRYPTO_KEY_SIZE)<br />    {<br />        OPENSSL_cleanse(chKey, sizeof(chKey) );<br />        OPENSSL_cleanse(chIV, sizeof(chIV) );<br />        return false;<br />    }<br />    fKeySet = true;<br />    return true;<br />}<br />bool CCrypter::SetKey(const CKeyingMaterial&#038; chNewKey, const std::vector&lt;unsigned char>&#038; chNewIV)<br />{<br />    if (chNewKey.size() != WALLET_CRYPTO_KEY_SIZE || chNewIV.size() != WALLET_CRYPTO_KEY_SIZE)<br />        return false;<br />    memcpy(&#038;chKey[0], &#038;chNewKey[0], sizeof chKey);<br />    memcpy(&#038;chIV[0], &#038;chNewIV[0], sizeof chIV);<br />    fKeySet = true;<br />    return true;<br />}<br />bool CCrypter::Encrypt(const CKeyingMaterial&#038; vchPlaintext, std::vector&lt;unsigned char> &#038;vchCiphertext)<br />{<br />    if (!fKeySet)<br />        return false;<br />    // max ciphertext len for a n bytes of plaintext is<br />    // n + AES_BLOCK_SIZE - 1 bytes<br />    int nLen = vchPlaintext.size();<br />    int nCLen = nLen + AES_BLOCK_SIZE, nFLen = 0;<br />    vchCiphertext = std::vector&lt;unsigned char> (nCLen);<br />    EVP_CIPHER_CTX ctx;<br />    bool fOk = true;<br />    EVP_CIPHER_CTX_init(&#038;ctx);<br />    if (fOk) fOk = EVP_EncryptInit_ex(&#038;ctx, EVP_aes_256_cbc(), NULL, chKey, chIV);<br />    if (fOk) fOk = EVP_EncryptUpdate(&#038;ctx, &#038;vchCiphertext[0], &#038;nCLen, &#038;vchPlaintext[0], nLen);<br />    if (fOk) fOk = EVP_EncryptFinal_ex(&#038;ctx, (&#038;vchCiphertext[0])+nCLen, &#038;nFLen);<br />    EVP_CIPHER_CTX_cleanup(&#038;ctx);<br />    if (!fOk) return false;<br />    vchCiphertext.resize(nCLen + nFLen);<br />    return true;<br />}<br />bool CCrypter::Decrypt(const std::vector&lt;unsigned char>&#038; vchCiphertext, CKeyingMaterial&#038; vchPlaintext)<br />{<br />    if (!fKeySet)<br />        return false;<br />    // plaintext will always be equal to or lesser than length of ciphertext<br />    int nLen = vchCiphertext.size();<br />    int nPLen = nLen, nFLen = 0;<br />    vchPlaintext = CKeyingMaterial(nPLen);<br />    EVP_CIPHER_CTX ctx;<br />    bool fOk = true;<br />    EVP_CIPHER_CTX_init(&#038;ctx);<br />    if (fOk) fOk = EVP_DecryptInit_ex(&#038;ctx, EVP_aes_256_cbc(), NULL, chKey, chIV);<br />    if (fOk) fOk = EVP_DecryptUpdate(&#038;ctx, &#038;vchPlaintext[0], &#038;nPLen, &#038;vchCiphertext[0], nLen);<br />    if (fOk) fOk = EVP_DecryptFinal_ex(&#038;ctx, (&#038;vchPlaintext[0])+nPLen, &#038;nFLen);<br />    EVP_CIPHER_CTX_cleanup(&#038;ctx);<br />    if (!fOk) return false;<br />    vchPlaintext.resize(nPLen + nFLen);<br />    return true;<br />}<br />bool EncryptSecret(const CKeyingMaterial&#038; vMasterKey, const CKeyingMaterial &#038;vchPlaintext, const uint256&#038; nIV, std::vector&lt;unsigned char> &#038;vchCiphertext)<br />{<br />    CCrypter cKeyCrypter;<br />    std::vector&lt;unsigned char> chIV(WALLET_CRYPTO_KEY_SIZE);<br />    memcpy(&#038;chIV[0], &#038;nIV, WALLET_CRYPTO_KEY_SIZE);<br />    if(!cKeyCrypter.SetKey(vMasterKey, chIV) )<br />        return false;<br />    return cKeyCrypter.Encrypt(*( (const CKeyingMaterial*)&#038;vchPlaintext), vchCiphertext);<br />}<br />bool DecryptSecret(const CKeyingMaterial&#038; vMasterKey, const std::vector&lt;unsigned char>&#038; vchCiphertext, const uint256&#038; nIV, CKeyingMaterial&#038; vchPlaintext)<br />{<br />    CCrypter cKeyCrypter;<br />    std::vector&lt;unsigned char> chIV(WALLET_CRYPTO_KEY_SIZE);<br />    memcpy(&#038;chIV[0], &#038;nIV, WALLET_CRYPTO_KEY_SIZE);<br />    if(!cKeyCrypter.SetKey(vMasterKey, chIV) )<br />        return false;<br />    return cKeyCrypter.Decrypt(vchCiphertext, *( (CKeyingMaterial*)&#038;vchPlaintext) );<br />}<br />bool CCryptoKeyStore::SetCrypted()<br />{<br />    LOCK(cs_KeyStore);<br />    if (fUseCrypto)<br />        return true;<br />    if (!mapKeys.empty() )<br />        return false;<br />    fUseCrypto = true;<br />    return true;<br />}<br />bool CCryptoKeyStore::Lock()<br />{<br />    if (!SetCrypted() )<br />        return false;<br />    {<br />        LOCK(cs_KeyStore);<br />        vMasterKey.clear();<br />    }<br />    NotifyStatusChanged(this);<br />    return true;<br />}<br />bool CCryptoKeyStore::Unlock(const CKeyingMaterial&#038; vMasterKeyIn)<br />{<br />    {<br />        LOCK(cs_KeyStore);<br />        if (!SetCrypted() )<br />            return false;<br />        CryptedKeyMap::const_iterator mi = mapCryptedKeys.begin();<br />        for (; mi != mapCryptedKeys.end(); ++mi)<br />        {<br />            const CPubKey &#038;vchPubKey = (*mi).second.first;<br />            const std::vector&lt;unsigned char> &#038;vchCryptedSecret = (*mi).second.second;<br />            CKeyingMaterial vchSecret;<br />            if(!DecryptSecret(vMasterKeyIn, vchCryptedSecret, vchPubKey.GetHash(), vchSecret) )<br />                return false;<br />            if (vchSecret.size() != 32)<br />                return false;<br />            CKey key;<br />            key.Set(vchSecret.begin(), vchSecret.end(), vchPubKey.IsCompressed() );<br />            if (key.GetPubKey() == vchPubKey)<br />                break;<br />            return false;<br />        }<br />        vMasterKey = vMasterKeyIn;<br />    }<br />    NotifyStatusChanged(this);<br />    return true;<br />}<br />bool CCryptoKeyStore::AddKeyPubKey(const CKey&#038; key, const CPubKey &#038;pubkey)<br />{<br />    {<br />        LOCK(cs_KeyStore);<br />        if (!IsCrypted() )<br />            return CBasicKeyStore::AddKeyPubKey(key, pubkey);<br />        if (IsLocked() )<br />            return false;<br />        std::vector&lt;unsigned char> vchCryptedSecret;<br />        CKeyingMaterial vchSecret(key.begin(), key.end() );<br />        if (!EncryptSecret(vMasterKey, vchSecret, pubkey.GetHash(), vchCryptedSecret) )<br />            return false;<br />        if (!AddCryptedKey(pubkey, vchCryptedSecret) )<br />            return false;<br />    }<br />    return true;<br />}<br />bool CCryptoKeyStore::AddCryptedKey(const CPubKey &#038;vchPubKey, const std::vector&lt;unsigned char> &#038;vchCryptedSecret)<br />{<br />    {<br />        LOCK(cs_KeyStore);<br />        if (!SetCrypted() )<br />            return false;<br />        mapCryptedKeys[vchPubKey.GetID()] = make_pair(vchPubKey, vchCryptedSecret);<br />    }<br />    return true;<br />}<br />bool CCryptoKeyStore::GetKey(const CKeyID &#038;address, CKey&#038; keyOut) const<br />{<br />    {<br />        LOCK(cs_KeyStore);<br />        if (!IsCrypted() )<br />            return CBasicKeyStore::GetKey(address, keyOut);<br />        CryptedKeyMap::const_iterator mi = mapCryptedKeys.find(address);<br />        if (mi != mapCryptedKeys.end() )<br />        {<br />            const CPubKey &#038;vchPubKey = (*mi).second.first;<br />            const std::vector&lt;unsigned char> &#038;vchCryptedSecret = (*mi).second.second;<br />            CKeyingMaterial vchSecret;<br />            if (!DecryptSecret(vMasterKey, vchCryptedSecret, vchPubKey.GetHash(), vchSecret) )<br />                return false;<br />            if (vchSecret.size() != 32)<br />                return false;<br />            keyOut.Set(vchSecret.begin(), vchSecret.end(), vchPubKey.IsCompressed() );<br />            return true;<br />        }<br />    }<br />    return false;<br />}<br />bool CCryptoKeyStore::GetPubKey(const CKeyID &#038;address, CPubKey&#038; vchPubKeyOut) const<br />{<br />    {<br />        LOCK(cs_KeyStore);<br />        if (!IsCrypted() )<br />            return CKeyStore::GetPubKey(address, vchPubKeyOut);<br />        CryptedKeyMap::const_iterator mi = mapCryptedKeys.find(address);<br />        if (mi != mapCryptedKeys.end() )<br />        {<br />            vchPubKeyOut = (*mi).second.first;<br />            return true;<br />        }<br />    }<br />    return false;<br />}<br />bool CCryptoKeyStore::EncryptKeys(CKeyingMaterial&#038; vMasterKeyIn)<br />{<br />    {<br />        LOCK(cs_KeyStore);<br />        if (!mapCryptedKeys.empty() || IsCrypted() )<br />            return false;<br />        fUseCrypto = true;<br />        BOOST_FOREACH(KeyMap::value_type&#038; mKey, mapKeys)<br />        {<br />            const CKey &#038;key = mKey.second;<br />            CPubKey vchPubKey = key.GetPubKey();<br />            CKeyingMaterial vchSecret(key.begin(), key.end() );<br />            std::vector&lt;unsigned char> vchCryptedSecret;<br />            if (!EncryptSecret(vMasterKeyIn, vchSecret, vchPubKey.GetHash(), vchCryptedSecret) )<br />                return false;<br />            if (!AddCryptedKey(vchPubKey, vchCryptedSecret) )<br />                return false;<br />        }<br />        mapKeys.clear();<br />    }<br />    return true;<br />}</div>
</blockquote>
<p>Many eyes, right ?  [<a href="#identifier_4_67843" class="footnote-link footnote-back-link">&#8617;</a>]</li><li id="footnote_5_67843" class="footnote">There is no way currently known to bruteforce an encrypted wallet.dat file. [<a href="#identifier_5_67843" class="footnote-link footnote-back-link">&#8617;</a>]</li><li id="footnote_6_67843" class="footnote">Metadata not encrypted ; rounds may be insufficient ; individual private key to master key encryption may be weak ; AES is suspicious by its NIST-nature ; passphrases are weaker than their size naively promises, and readily recognized in a string dump. [<a href="#identifier_6_67843" class="footnote-link footnote-back-link">&#8617;</a>]</li><li id="footnote_7_67843" class="footnote">Modularity for instance might be a good idea, there's no reason for a third party <a href="http://btcbase.org/log-search?q=specificity+of+diddling">to know</a> what exact encryption scheme any end user employs for his wallet. [<a href="#identifier_7_67843" class="footnote-link footnote-back-link">&#8617;</a>]</li></ol>
              <div>
                <div class="alignleft">&laquo; <a href="http://trilema.com/2016/borcanelanul-elanul-la-borcan/">Borcanelanul (elanul la borcan)</a></div>
                <div class="alignright"><a href="http://trilema.com/2016/eulora-012/">Eulora 0.1.2</a> &raquo;</div>
              </div>

<div class="clear"></div>
                                                    </div>
                  <div class="info">
                             </span><span class="category">Category: Uncategorized</span>
   </div>
                   <div class="info_bot"></div>
            </div>
          <div id="postmetadata">
                        Comments feed : <a href='http://trilema.com/2016/the-ideal-bitcoin-wallet/feed/'>RSS 2.0</a>.                                             Leave your own <a href="#respond">comment</a> below, or send a <a href="http://trilema.com/2016/the-ideal-bitcoin-wallet/trackback/" rel="trackback">trackback</a>.                                   </div>
  
<!-- You can start editing here. -->
		<p class="commenttitle"><a name="comments"></a>9 Responses</p>
		
		<ol class="commentlist">
									<li id="comment-118318" class="commentbody"><div class="commenthead"><img alt='Stanislav Datskovskiy`s avatar' src='http://www.loper-os.org/avatar.png' class='avatar avatar-32 photo' height='32' width='32' />								<div class="commentcount">1</div>
								<span class="authorlink"><a href='http://www.loper-os.org' class='url'>Stanislav Datskovskiy</a><img src="http://trilema.com/wp-content/themes/trilema/images/insigna-tech.png" class="insigna" alt="insigna de tehnolog" height=10 width=24 /></span>&nbsp;								<span class=""></span>
													<br />
								<a class="commentlink" href="#comment-118318" title="">Sunday, 31 July 2016</a>
							</div>
						<p>TX generator and privkey-storing sigtron are wholly-orthogonal, ought to speak a standard and naked-eye protocol, and reside on physically-separate and isolated devices...</p>
						</li>

										<li id="comment-118319" class="adminbody"><div class="adminhead"><img alt='Mircea Popescu`s avatar' src='http://trilema.com/avatar.png' class='avatar avatar-32 photo' height='32' width='32' />								<div class="commentcount">2</div>
								<span class="authorlink">Mircea Popescu</span>&nbsp;								<span class=""></span>
													<br />
								<a class="commentlink" href="#comment-118319" title="">Sunday, 31 July 2016</a>
							</div>
						<p>And that protocol is de-facto "raw transaction".</p>
						</li>

										<li id="comment-118331" class="commentbody"><div class="commenthead"><img alt='anon`s avatar' src='http://trilema.com/default_avatar.png' class='avatar avatar-32 photo' height='32' width='32' />								<div class="commentcount">3</div>
								<span class="authorlink">anon</span>&nbsp;								<span class=""></span>
													<br />
								<a class="commentlink" href="#comment-118331" title="">Sunday, 31 July 2016</a>
							</div>
						<p>What about <a href="https://bitcointalk.org/index.php?topic=329954.msg3549825#msg3549825" >the -000 lols</a>? Is a thousand enough for anyone?</p>
						</li>

										<li id="comment-118332" class="adminbody"><div class="adminhead"><img alt='Mircea Popescu`s avatar' src='http://trilema.com/avatar.png' class='avatar avatar-32 photo' height='32' width='32' />								<div class="commentcount">4</div>
								<span class="authorlink">Mircea Popescu</span>&nbsp;								<span class=""></span>
													<br />
								<a class="commentlink" href="#comment-118332" title="">Sunday, 31 July 2016</a>
							</div>
						<p>These words pain us.</p>
						</li>

										<li id="comment-118334" class="commentbody"><div class="commenthead"><img alt='bitCone`s avatar' src='http://trilema.com/default_avatar.png' class='avatar avatar-32 photo' height='32' width='32' />								<div class="commentcount">5</div>
								<span class="authorlink">bitCone</span>&nbsp;								<span class=""></span>
													<br />
								<a class="commentlink" href="#comment-118334" title="">Sunday, 31 July 2016</a>
							</div>
						<p>How about</p>
<blockquote><p>sendmany 	 {address:amount,...} [minconf=1] [comment] 	amounts are <b>double-precision floating point numbers</b></p></blockquote>
						</li>

										<li id="comment-118335" class="adminbody"><div class="adminhead"><img alt='Mircea Popescu`s avatar' src='http://trilema.com/avatar.png' class='avatar avatar-32 photo' height='32' width='32' />								<div class="commentcount">6</div>
								<span class="authorlink">Mircea Popescu</span>&nbsp;								<span class=""></span>
													<br />
								<a class="commentlink" href="#comment-118335" title="">Sunday, 31 July 2016</a>
							</div>
						<p>Obviously original author was career javascript analyst.</p>
						</li>

						</ol>



	<ol class="commentlist">
				<li class="trackbody" id="comment-132461">
					<div class='trackhead'>
						<div class="commentcount">7</div>
						<span class="authorlink"><a href='http://fixpoint.welshcomputing.com/2019/gales-bitcoin-wallet-spec-and-battle-plan/?b=no%20S-expre&amp;e=no%20S-expressions%20or%20JSON%20or%20similar.%20I%20believe%20this%20also%20brings%20it%20in%20' class='url'>Gales Bitcoin Wallet spec and battle plan &laquo; Fixpoint</a></span>&nbsp;(via Pingback)						<span class=""></span>
						<br />
						<a class="commentlink" href="#comment-132461" title="">Thursday, 28 November 2019</a>
					</div>
					<p>[...] no S-expressions or JSON or similar. I believe this also brings it in closer alignment with the ideal. A second simplification is in the storage of addresses and keys, following a philosophy of "the [...]</p>
				</li>

				<li class="trackbody" id="comment-142585">
					<div class='trackhead'>
						<div class="commentcount">8</div>
						<span class="authorlink"><a href='http://trilema.com/2016/gossipd-design-document?b=this%20in%20the%20&amp;e=ment#select' class='url'>[G]ossipd design document on Trilema - A blog by Mircea Popescu.</a></span>&nbsp;(via Pingback)						<span class=""></span>
						<br />
						<a class="commentlink" href="#comment-142585" title="">Wednesday, 8 January 2020</a>
					</div>
					<p>[...] this in the form of a plaintext file stands out as the height of sense. See also the Bitcoin wallet discussion. [&#8617;]At the very least in the now familiar e, N, comment [...]</p>
				</li>

				<li class="trackbody" id="comment-142748">
					<div class='trackhead'>
						<div class="commentcount">9</div>
						<span class="authorlink"><a href='http://trilema.com/2016/how-to-cut-the-wallet?b=That%20the%20wal&amp;e=s%20he#select' class='url'>How to cut the wallet ? on Trilema - A blog by Mircea Popescu.</a></span>&nbsp;(via Pingback)						<span class=""></span>
						<br />
						<a class="commentlink" href="#comment-142748" title="">Wednesday, 8 January 2020</a>
					</div>
					<p>[...] That the wallet become a solipsistic node. As per previous discussion, fixing the horrible format of the inherited Bitcoin will allow the operator to inject coinbases he [...]</p>
				</li>

	</ol>


		<strong id="respond">Add your cents!</strong>
 <small>&raquo; <br /><ul>If this is your first comment, it will wait to be approved. This usually takes a few hours. Subsequent comments are not delayed.</ul></small>
			<form action="http://trilema.com/wp-comments-post.php" method="post" id="commentform">
	

<!--- This is just a decoy ;)

<p><input type="text" name="author" id="author" value="" size="22" tabindex="1" />
						<label for="author"><small>Name&nbsp;(required)</small></label></p>
					<p><input type="text" name="email" id="email" value="" size="22" tabindex="2" />

						<label for="email"><small>E-Mail (will not be published , required)</small></label></p>
					<p><input type="text" name="url" id="url" value="http://pest" size="22" tabindex="3" />

-->

					<p><input type="text" name="authorfa84cd8" id="authorfa84cd8" value="" size="22" tabindex="1" />
						<label for="author"><small>Name&nbsp;(required)</small></label></p>
					<p><input type="text" name="emailfa84cd8" id="emailfa84cd8" value="" size="22" tabindex="2" />
						<label for="email"><small>E-Mail
</small></label></p>
					<p><input type="text" name="urlfa84cd8" id="urlfa84cd8" value="" size="22" tabindex="3" />

						<label for="url"><small>Website (optional)</small></label></p>

<!--<p><small><strong>XHTML:</strong> You can use these tags:&nbsp;&lt;a href=&quot;&quot; title=&quot;&quot;&gt; &lt;abbr title=&quot;&quot;&gt; &lt;acronym title=&quot;&quot;&gt; &lt;b&gt; &lt;blockquote cite=&quot;&quot;&gt; &lt;cite&gt; &lt;code&gt; &lt;del datetime=&quot;&quot;&gt; &lt;em&gt; &lt;i&gt; &lt;q cite=&quot;&quot;&gt; &lt;strike&gt; &lt;strong&gt; </small></p>-->

<!--- This is just a decoy ;)

<p><input type="text" name="author" id="author" value="" size="22" tabindex="1" />
						<label for="author"><small>Name&nbsp;(required)</small></label></p>
					<p><input type="text" name="email" id="email" value="" size="22" tabindex="2" />

						<label for="email"><small>E-Mail (will not be published , required)</small></label></p>
					<p><input type="text" name="url" id="url" value="http://pest" size="22" tabindex="3" />

-->

				<p><textarea name="comment" id="comment" cols="60" rows="12" tabindex="4"></textarea></p>
				<p><input name="submit" type="submit" id="submit" tabindex="5" value="Send" />
				<input type="hidden" name="comment_post_ID" value="67843" /></p>
				<input type="hidden" name="comment_post_time" value="1624833112-201.206.191.92" /></p>

				
			</form>
  		</div><div id="sidebar">
        <div id="sidebar_top"></div>
        <div id="sidebar1">
                <ul>
         

<ul>
                        <h5>Recent Comments</h5>
      <ul>
      	<li><a href=http://trilema.com/2011/ce-am-pierdut-si-voi-n-ati-avut/#comment-165319 >Mircea Popescu</a> It's baaaaack!!!</li>
	<li><a href=http://trilema.com/2021/royal-revolt-ii-complete-strategy-guide-also-by-very-far-the-best-on-the-internet/#comment-165310 >Mircea Popescu</a> Well, it's a both-ways tower defense, you build the pathway and the op...</li>
	<li><a href=http://trilema.com/2021/royal-revolt-ii-complete-strategy-guide-also-by-very-far-the-best-on-the-internet/#comment-165307 >Diana Coman</a>  the game went offline (it does that after five or so minutes of inactivity...</li>
	<li><a href=http://trilema.com/2021/the-apprenticeship-of-duddy-kravitz/#comment-165303 >Mircea Popescu</a> Ahahaha. If we met back when I was still in that line I'd have totally...</li>
	<li><a href=http://trilema.com/2021/the-apprenticeship-of-duddy-kravitz/#comment-165302 >pletzalcoatl</a> You were thinking a pallid Danny DeVito in a purple crushed velvet suit...</li>
	<li><a href=http://trilema.com/2019/forum-logs-for-05-nov-2015/#comment-165300 >Mircea Popescu</a> You're not fooling anyone, you know.</li>
	<li><a href=http://trilema.com/2019/forum-logs-for-05-nov-2015/#comment-165297 >Tyrone White</a> What's up to all</li>
	<li><a href=http://trilema.com/2021/hoe-jokes/#comment-165274 >Mircea Popescu</a> &updated.</li>
	<li><a href=http://trilema.com/2021/the-apprenticeship-of-duddy-kravitz/#comment-165253 >Mircea Popescu</a> PS. s/undertaker/liquidator/ on re-read. Nfi what I was thinking.</li>
	<li><a href=http://trilema.com/2016/lxs-ninxs/#comment-165251 >Mircea Popescu</a> Meh. More nudes less obscure software packages, I don't watsup or w/e.</li>
	<li><a href=http://trilema.com/2021/the-apprenticeship-of-duddy-kravitz/#comment-165250 >Mircea Popescu</a> Obscure TV actor, plenty of those. (I didn't, for instance, review the...</li>
	<li><a href=http://trilema.com/2021/the-apprenticeship-of-duddy-kravitz/#comment-165239 >CarpraC</a> Since this post brought up ancient actors, their experience and quality, what...</li>
	<li><a href=http://trilema.com/2016/lxs-ninxs/#comment-165227 >temptease</a> call me whatsapp +79910404425</li>
	<li><a href=http://trilema.com/2020/trilema-altogether-no-longer-showing/#comment-165222 >Mircea Popescu</a> Heh. Never heard of it. (I however have heard of that kinda posturing,...</li>
	<li><a href=http://trilema.com/2020/trilema-altogether-no-longer-showing/#comment-165221 >Anon</a> I don't know, some kind of "help you with your finances" scam/online...</li>
	<li><a href=http://trilema.com/2020/trilema-altogether-no-longer-showing/#comment-165220 >Mircea Popescu</a> No fucking idea, what is it ?</li>
	<li><a href=http://trilema.com/2020/trilema-altogether-no-longer-showing/#comment-165219 >Anon</a> In the same line, what is Intuit?</li>
	<li><a href=http://trilema.com/2020/kitty-freipurr-von-meow-and-other-tales-of-bring-your-own-adventure-to-tamarindo/#comment-165218 >Mircea Popescu</a> Heh. Nothing lasts forever, and the "independent woman" least of all.</li>
	<li><a href=http://trilema.com/2020/trilema-altogether-no-longer-showing/#comment-165217 >Mircea Popescu</a> Wtf is this inane nonsense! Oh, I get it, artificially interesting...</li>
	<li><a href=http://trilema.com/2020/kitty-freipurr-von-meow-and-other-tales-of-bring-your-own-adventure-to-tamarindo/#comment-165216 >lexy229</a> &gt; how exactly did you figure out what to do to have your avatar show up by...</li>
	<li><a href=http://trilema.com/2020/trilema-altogether-no-longer-showing/#comment-165214 >anon</a> Have a laugh Description Planet Earth's most widely read blog.... Read More Tim...</li>
	<li><a href=http://trilema.com/2020/trilema-altogether-no-longer-showing/#comment-165212 >Mircea Popescu</a> Heh, the yearly problems of last year's. What a life.</li>
	<li><a href=http://trilema.com/2021/breaking-usg-president-belect-pidden-announces-plans-to-sign-epochal-factaltering-change-footnote-executive-history/#comment-165102 >Mircea Popescu</a> Really, it's top100-ish pretty much everywhere.</li>
	<li><a href=http://trilema.com/2021/breaking-usg-president-belect-pidden-announces-plans-to-sign-epochal-factaltering-change-footnote-executive-history/#comment-165101 >anon</a> #117 in Russia too.</li>
	<li><a href=http://trilema.com/2021/breaking-usg-president-belect-pidden-announces-plans-to-sign-epochal-factaltering-change-footnote-executive-history/#comment-165100 >Joshue</a> Meanwhile when it comes to being famous in Gibraltar...</li>
      </ul>
   

        <br />
</ul>
        </div>
                <div id="sidebar2">
                <ul>
                        <li><h5>Recent Articles</h5><ul>
                	<li><a href='http://trilema.com/2021/n-i-meaning-h-went-to-m-and/' title='N &#038; I (meaning H) went to M and...'>N &#038; I (meaning H) went to M and...</a></li>
	<li><a href='http://trilema.com/2021/royal-revolt-ii-complete-strategy-guide-also-by-very-far-the-best-on-the-internet/' title='Royal Revolt II complete strategy guide, also by very far the best on the Internet.'>Royal Revolt II complete strategy guide, also by very far the best on the Internet.</a></li>
	<li><a href='http://trilema.com/2021/laltra-meta-del-cielo/' title='L&#039;altra metà del cielo'>L'altra metà del cielo</a></li>
	<li><a href='http://trilema.com/2021/hoe-jokes/' title='Hoe Jokes'>Hoe Jokes</a></li>
	<li><a href='http://trilema.com/2021/the-apprenticeship-of-duddy-kravitz/' title='The Apprenticeship of Duddy Kravitz'>The Apprenticeship of Duddy Kravitz</a></li>
	<li><a href='http://trilema.com/2021/moe-jokes/' title='Moe Jokes'>Moe Jokes</a></li>
	<li><a href='http://trilema.com/2021/joe-jokes/' title='Joe Jokes'>Joe Jokes</a></li>
	<li><a href='http://trilema.com/2021/carried-away/' title='Carried Away'>Carried Away</a></li>
	<li><a href='http://trilema.com/2021/the-value-of-subhuman-life-and-other-non-themes-of-scummy-preoccupation/' title='The value of subhuman life, and other non-themes of scummy preoccupation'>The value of subhuman life, and other non-themes of scummy preoccupation</a></li>
	<li><a href='http://trilema.com/2021/have-you-ever-read-les-liaisons-dangereuses/' title='Have you ever read Les Liaisons dangereuses ?'>Have you ever read Les Liaisons dangereuses ?</a></li>
	<li><a href='http://trilema.com/2021/royal-revolt-ii-kicks-ass/' title='Royal Revolt II Kicks Ass!'>Royal Revolt II Kicks Ass!</a></li>
	<li><a href='http://trilema.com/2021/on-being-female-and-being-a-woman/' title='On being female, and being a woman.'>On being female, and being a woman.</a></li>
	<li><a href='http://trilema.com/2021/il-gatto-mammone/' title='Il gatto mammone'>Il gatto mammone</a></li>
	<li><a href='http://trilema.com/2021/hey-bitches-smell-my-armpits/' title='Hey bitches! Smell my armpits!'>Hey bitches! Smell my armpits!</a></li>
	<li><a href='http://trilema.com/2021/shield-for-murder/' title='Shield for murder'>Shield for murder</a></li>
	<li><a href='http://trilema.com/2021/moral-myopia/' title='Moral myopia'>Moral myopia</a></li>
	<li><a href='http://trilema.com/2021/amarcord/' title='Amarcord'>Amarcord</a></li>
	<li><a href='http://trilema.com/2021/la-minorenne/' title='La minorenne'>La minorenne</a></li>
	<li><a href='http://trilema.com/2021/the-deplorable-generation/' title='The deplorable generation'>The deplorable generation</a></li>
	<li><a href='http://trilema.com/2021/breaking-usg-president-belect-pidden-announces-plans-to-sign-epochal-factaltering-change-footnote-executive-history/' title='BREAKING : USG President-Belect Pidden Announces Plans To Sign Epochal Factaltering Change Footnote Executive History!'>BREAKING : USG President-Belect Pidden Announces Plans To Sign Epochal Factaltering Change Footnote Executive History!</a></li>
</ul></li>
                

        
<li class="pagenav"><h5>Pages</h5><ul><li class="page_item page-item-220"><a href="http://trilema.com/archives-categories/" title="Archives &#038; Categories">Archives &#038; Categories</a></li>
<li class="page_item page-item-34333"><a href="http://trilema.com/contact-pgp/" title="Contact ; PGP">Contact ; PGP</a></li>
<li class="page_item page-item-181"><a href="http://trilema.com/copyright-notice/" title="Copyright Notice">Copyright Notice</a></li>
<li class="page_item page-item-62578"><a href="http://trilema.com/eulora-shop/" title="Eulora Shop">Eulora Shop</a></li>
<li class="page_item page-item-94098"><a href="http://trilema.com/in-the-press/" title="In the press">In the press</a></li>
<li class="page_item page-item-39332"><a href="http://trilema.com/thesaurus-vocabulary/" title="Thesaurus &#038; Vocabulary">Thesaurus &#038; Vocabulary</a></li>
</ul></li>
<h5>Say NO! to platforms</h5>      
<center><a href=http://trilema.com/2019/no-platforms/><img src=http://trilema.com/wp-content/uploads/2019/08/no-facebook.png></img></a></center>

                                                        </ul>
        </div>

        <div id="sidebar_bot">
</div>

<div id="banners">

</div>
</div>
		</div>		
<div id="footer">			
<a href="http://trilema.com/feed/" title="RSS Feed"><img src="http://trilema.com/wp-content/themes/trilema/images/rss.jpg" alt="Subscribe RSS" class="rss"/>
</a>		
Copyright &copy; 2008 - 
2021 for all text and images.			
<br /> 
Trilema is. Everything else's just hearsay. 


</div>	
</div>
</div>

	
<script type="text/javascript">function findPos(obj) {
  var curtop = 0;
  while (obj && obj.offsetParent) {
    curtop += obj.offsetTop; // todo: + webkit-transform
    obj = obj.offsetParent;
  }
  return curtop;
}
var artificial = null;
var prevhash = "";
function scrollToHash() {
  if (document.location.hash.replace(/^#/, "")==prevhash.replace(/^#/, ""))
    return;
  prevhash = document.location.hash;
  if (document.location.hash.match(/#selection-[0-9.]+%/)) {
    var p = parseFloat(document.location.hash.substring(1));
    if (0 < p && p < 100 /*&& p%5 != 0*/) {
      var content = document.getElementById("shash-67843")
      var y = findPos(content) + (content.offsetHeight)*p/100;
      window.scrollTo(0, y-16);
    }
  }

  var adr = document.location.hash.match(/#selection-(\d+).(\d+)-(\d+).(\d+)/);
  if (adr) {
    var pos=0,begin=null,end=null;
    function recur(e) {
      if (e.nodeType==1) pos = (pos&~1)+2;
      if (e.nodeType==3) pos = pos|1;
      if (pos==adr[1]) begin=[e, adr[2]];
      if (pos==adr[3]) end  =[e, adr[4]];
      for (var i=0; i<e.childNodes.length; i++)
        recur(e.childNodes[i]);
      if (e.childNodes.length>0 && e.lastChild.nodeType==3)
        pos = (pos&~1)+2;
    }
    // remove old "artificial" span if any
    if (artificial) {
      artificial.previousSibling.data += artificial.childNodes[0].data;
      artificial.parentNode.removeChild(artificial);
    }
    var content = document.getElementById("shash-67843");
    recur(content.childNodes[content.childNodes[0].nodeType==3 ? 1 : 0]);
    if (begin!=null && end!=null) {
      // scroll to selection
      if (begin[0].nodeType==3) {
        var text = document.createTextNode(begin[0].data.substr(0, begin[1]));
        artificial = document.createElement("SPAN");
        artificial.appendChild(document.createTextNode(begin[0].data.substr(begin[1])));

        begin[0].parentNode.insertBefore(text, begin[0]);
        begin[0].parentNode.replaceChild(artificial, begin[0]);

        if (end[0]===begin[0])
          end = [artificial.childNodes[0], end[1]-begin[1]];
        begin = [artificial.childNodes[0], 0];
        /* window.scrollTo(0, findPos(artificial)-8); */ artificial.scrollIntoView(true);
      } else if (begin[0].nodeType==1) {
        /* window.scrollTo(0, findPos(begin[0])-8);   */ begin[0].scrollIntoView(true);
      }

      if (window.getSelection) {
        var sel = window.getSelection();
        sel.removeAllRanges();
        var range = document.createRange();
        range.setStart(begin[0], begin[1]);
        range.setEnd  (  end[0],   end[1]);
        sel.addRange(range);
      } else if (document.selection) { // IE
      }
    }
  }
}
window.onhashchange = scrollToHash;
var initScrollToHashDone = false;
function initScrollToHash() {
  if (!initScrollToHashDone) {
    initScrollToHashDone = true;
    scrollToHash();
  }
}
window.onload = initScrollToHash;
setTimeout(initScrollToHash, 500); /* onload can be delayed by counter code */

//document.onselectionchange = /* only webkit has working document.onselectionchange */
document.onmousedown = document.onmouseup = function(e) {
  var newhash = "";
  if (window.getSelection) {
    var sel=window.getSelection();
    if (!sel.isCollapsed) {
      var pos=0,begin=[0,0],end=[0,0];
      var range=sel.getRangeAt(0);
      function recur(e) {
        if (e===artificial) {
          if (range.startContainer===e.childNodes[0]) begin=[pos, e.previousSibling.data.length+range.startOffset];
          if (range.endContainer  ===e.childNodes[0]) end  =[pos, e.previousSibling.data.length+range.endOffset ];
        } else {
          if (e.nodeType==1) pos = (pos&~1)+2;
          if (e.nodeType==3) pos = pos|1;
          if (range.startContainer===e) begin=[pos, range.startOffset];
          if (range.endContainer  ===e) end  =[pos, range.endOffset ];
          for (var i=0; i<e.childNodes.length; i++)
            recur(e.childNodes[i]);
          if (e.childNodes.length>0 && e.lastChild.nodeType==3)
            pos = (pos&~1)+2;
        }
      }

      var content = document.getElementById("shash-67843");
      recur(content.childNodes[content.childNodes[0].nodeType==3 ? 1 : 0]);
      if (begin[0]>0 && end[0]>0) {
        newhash = "selection-"+begin[0]+"."+begin[1]+"-"+end[0]+"."+end[1];
      }
    }
  } else if (document.selection) { // IE
  }

  try {
    var oldhash = location.hash.replace(/^#/, "");
    if (oldhash != newhash) {
      prevhash = newhash; /* avoid firing window.onhashchange and scrolling */
      if (history.replaceState)
        history.replaceState('', document.title, newhash=="" ? window.location.pathname : '#'+newhash);
      else
        location.hash = newhash;
    }
  } catch(e) {
  }
};
</script></body></html>
